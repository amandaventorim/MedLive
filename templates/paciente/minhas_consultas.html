{% extends "base_paciente.html" %}
{% block conteudo %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/minhas_consultas.css">
{% endblock %}

    <section class="consultations-section">
        <div class="container">
            <!-- Mensagem de sucesso -->
            {% if mensagem_sucesso %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="bi bi-check-circle-fill me-2"></i>
                {{ mensagem_sucesso }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endif %}
            
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold text-azul">Minhas Consultas</h2>
                <a href="/buscar_medicos" class="btn btn-vermelho">
                    <i class="bi bi-plus-circle me-2"></i>Nova Consulta
                </a>
            </div>

            <!-- Filters -->
            <div class="filter-tabs">
                <div class="filter-tab active" onclick="filterConsultations('all')">
                    Todas
                </div>
                <div class="filter-tab" onclick="filterConsultations('today')">
                    Hoje
                </div>
                <div class="filter-tab" onclick="filterConsultations('upcoming')">
                    Próximas
                </div>
                <div class="filter-tab" onclick="filterConsultations('completed')">
                    Realizadas
                </div>
                <div class="filter-tab" onclick="filterConsultations('cancelled')">
                    Canceladas
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="filter-card">
                <div class="row g-3 align-items-center">
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="searchInput"
                            placeholder="Buscar por médico ou especialidade..." oninput="searchConsultations()">
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="specialtyFilter" onchange="filterBySpecialty()">
                            <option value="">Todas as especialidades</option>
                            <option value="Cardiologia">Cardiologia</option>
                            <option value="Dermatologia">Dermatologia</option>
                            <option value="Clínica Geral">Clínica Geral</option>
                            <option value="Pediatria">Pediatria</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Consultations List -->
            <div class="filter-card">
                <div id="consultationsList">
                    {% if consultas %}
                        {% for consulta in consultas %}
                            {% set status_map = {
                                'agendado': 'upcoming',
                                'hoje': 'today', 
                                'realizada': 'completed',
                                'cancelada': 'cancelled'
                            } %}
                            {% set status = status_map.get(consulta.status, 'upcoming') %}
                            {% set status_text_map = {
                                'upcoming': 'Agendada',
                                'today': 'Hoje',
                                'completed': 'Realizada', 
                                'cancelled': 'Cancelada'
                            } %}
                            {% set status_text = status_text_map.get(status, 'Agendada') %}
                            
                            <div class="consultation-card {{ status }}">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <div class="d-flex align-items-center">
                                            <div class="doctor-avatar">
                                                {% if consulta.fotoMedico %}
                                                    <img src="{{ consulta.fotoMedico }}" alt="Foto do Dr. {{ consulta.nomeMedico }}" 
                                                         class="rounded-circle doctor-photo" 
                                                         style="width: 60px; height: 60px; object-fit: cover;">
                                                {% else %}
                                                    <div class="avatar-initials">
                                                        {% if consulta.nomeMedico %}
                                                            {{ consulta.nomeMedico.split()[0][0] }}{{ consulta.nomeMedico.split()[-1][0] if consulta.nomeMedico.split()|length > 1 else '' }}
                                                        {% else %}
                                                            DR
                                                        {% endif %}
                                                    </div>
                                                {% endif %}
                                            </div>
                                            <div class="flex-grow-1">
                                                <div class="d-flex align-items-center gap-2 mb-2">
                                                    <div class="consultation-time">{{ consulta.dataAgendamento }} às {{ consulta.horario }}</div>
                                                    <span class="status-badge {{ status }}">{{ status_text }}</span>
                                                </div>
                                                <h5 class="fw-bold text-azul mb-1">{{ consulta.nomeMedico or 'Dr. [Nome não disponível]' }}</h5>
                                                <div class="d-flex align-items-center gap-2 mb-2">
                                                    <span class="text-secondary">CRM: {{ consulta.crm or 'N/A' }}</span>
                                                    
                                                </div>
                                                <div class="d-flex align-items-center gap-3">
                                                    <div class="rating-stars">
                                                        ★★★★★
                                                        <span class="text-muted">5.0</span>
                                                    </div>
                                                    <span class="fw-bold text-success">R$ {{ "%.2f"|format(consulta.preco) if consulta.preco else '0,00' }}</span>
                                                    {% if consulta.queixa %}
                                                        <span class="text-muted">Motivo: {{ consulta.queixa }}</span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        {% if status == 'today' %}
                                            <div class="d-flex gap-2 justify-content-end flex-wrap">
                                                <a href="/sala_espera" class="btn btn-join">
                                                    <i class="bi bi-camera-video me-2"></i>Entrar
                                                </a>
                                                <a href="/agendar_consulta" class="btn btn-verde">
                                                    <i class="bi bi-calendar me-2"></i>Reagendar
                                                </a>
                                            </div>
                                        {% elif status == 'upcoming' %}
                                            <div class="d-flex gap-2 justify-content-end flex-wrap">
                                                <a href="/agendar_consulta" class="btn btn-verde">
                                                    <i class="bi bi-calendar me-2"></i>Reagendar
                                                </a>
                                                <button class="btn btn-cancelar" data-consulta-id="{{ consulta.idAgendamento }}">
                                                    <i class="bi bi-x-circle me-2"></i>Cancelar
                                                </button>
                                            </div>
                                        {% elif status == 'completed' %}
                                            <div class="d-flex gap-2 justify-content-end flex-wrap">
                                                <a href="/agendar_consulta" class="btn btn-verde">
                                                    <i class="bi bi-arrow-repeat me-2"></i>Agendar Novamente
                                                </a>
                                                <button class="btn btn-azul-claro" data-consulta-id="{{ consulta.idAgendamento }}">
                                                    <i class="bi bi-calendar me-2"></i>Detalhes
                                                </button>
                                            </div>
                                        {% elif status == 'cancelled' %}
                                            <div class="d-flex gap-2 justify-content-end flex-wrap">
                                                <a href="/agendar_consulta" class="btn btn-verde">
                                                    <i class="bi bi-arrow-repeat me-2"></i>Agendar Novamente
                                                </a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <!-- Estado vazio -->
                        <div id="emptyState">
                            <div class="text-center py-5">
                                <i class="bi bi-calendar-x display-1 text-muted mb-3"></i>
                                <h4 class="text-muted">Nenhuma consulta encontrada</h4>
                                <p class="text-muted mb-4">Você ainda não possui consultas agendadas.</p>
                                <a href="/buscar_medicos" class="btn btn-vermelho">
                                    <i class="bi bi-plus-circle me-2"></i>Agendar Nova Consulta
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>


{% block extra_js %}
<!-- <script src="/static/js/minhas_consultas.js"></script> -->
<script src="/static/js/minhas_consultas.js"></script>
{% endblock %}

{% endblock %}