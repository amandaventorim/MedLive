<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Verifica√ß√£o de Email</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #001942;
            text-align: center;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #001942;
        }
        .endpoint {
            background: #001942;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
        }
        .button {
            background: linear-gradient(135deg, #001942 0%, #003366 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .button:hover {
            opacity: 0.9;
        }
        .result {
            background: white;
            border: 2px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            min-height: 50px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        .error {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        input {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            width: 300px;
            font-size: 14px;
        }
        label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: bold;
            color: #001942;
        }
        .info {
            background: #d1ecf1;
            border-left: 4px solid #0c5460;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #0c5460;
        }
        .code-display {
            font-size: 32px;
            text-align: center;
            letter-spacing: 10px;
            color: #001942;
            font-weight: bold;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Verifica√ß√£o de Email</h1>
        
        <div class="info">
            <strong>üìå Instru√ß√µes:</strong><br>
            1. Digite um email de teste<br>
            2. Clique em "Gerar C√≥digo"<br>
            3. Copie o c√≥digo exibido<br>
            4. Clique em "Verificar C√≥digo"<br>
            5. Teste tamb√©m cen√°rios de erro (c√≥digo errado, etc.)
        </div>

        <!-- TESTE 1: Gerar C√≥digo -->
        <div class="test-section">
            <h2>üé≤ Teste 1: Gerar C√≥digo</h2>
            <p>Simula o envio do c√≥digo de verifica√ß√£o</p>
            
            <label for="email1">Email:</label>
            <input type="email" id="email1" placeholder="seu@email.com" value="teste@demo.com">
            
            <br><br>
            <button class="button" onclick="gerarCodigo()">Gerar C√≥digo</button>
            
            <div class="endpoint">
                POST /gerar_codigo_verificacao<br>
                Body: { "email": "..." }
            </div>
            
            <div id="resultado1" class="result">Aguardando...</div>
            <div id="codigoDisplay" class="code-display" style="display: none;"></div>
        </div>

        <!-- TESTE 2: Verificar C√≥digo -->
        <div class="test-section">
            <h2>‚úÖ Teste 2: Verificar C√≥digo</h2>
            <p>Valida o c√≥digo digitado pelo usu√°rio</p>
            
            <label for="email2">Email:</label>
            <input type="email" id="email2" placeholder="seu@email.com" value="teste@demo.com">
            
            <label for="codigo">C√≥digo (6 d√≠gitos):</label>
            <input type="text" id="codigo" placeholder="123456" maxlength="6">
            
            <br><br>
            <button class="button" onclick="verificarCodigo()">Verificar C√≥digo</button>
            <button class="button" style="background: #6c757d;" onclick="testarCodigoErrado()">Testar C√≥digo Errado</button>
            
            <div class="endpoint">
                POST /verificar_codigo<br>
                Body: { "email": "...", "codigo": "..." }
            </div>
            
            <div id="resultado2" class="result">Aguardando...</div>
        </div>

        <!-- TESTE 3: Cen√°rios de Erro -->
        <div class="test-section">
            <h2>‚ö†Ô∏è Teste 3: Cen√°rios de Erro</h2>
            <p>Testa valida√ß√µes e limites de seguran√ßa</p>
            
            <button class="button" onclick="testarTentativasExcedidas()">5 Tentativas Erradas</button>
            <button class="button" onclick="testarCodigoInexistente()">C√≥digo Inexistente</button>
            
            <div id="resultado3" class="result">Clique em um bot√£o para testar</div>
        </div>

        <!-- TESTE 4: Fluxo Completo -->
        <div class="test-section">
            <h2>üîÑ Teste 4: Fluxo Completo</h2>
            <p>Simula o fluxo completo do usu√°rio</p>
            
            <button class="button" onclick="fluxoCompleto()">Executar Fluxo Completo</button>
            
            <div id="resultado4" class="result">Aguardando...</div>
        </div>
    </div>

    <script>
        let codigoGerado = null;

        async function gerarCodigo() {
            const email = document.getElementById('email1').value;
            const resultado = document.getElementById('resultado1');
            const codigoDisplay = document.getElementById('codigoDisplay');
            
            if (!email) {
                resultado.className = 'result error';
                resultado.textContent = 'Por favor, digite um email';
                return;
            }

            resultado.textContent = '‚è≥ Gerando c√≥digo...';
            resultado.className = 'result';

            try {
                const response = await fetch('/gerar_codigo_verificacao', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                });

                const data = await response.json();

                if (data.success) {
                    codigoGerado = data.demo_code;
                    resultado.className = 'result success';
                    resultado.textContent = `‚úÖ C√≥digo gerado com sucesso!\n\nResposta da API:\n${JSON.stringify(data, null, 2)}`;
                    
                    // Exibir c√≥digo em destaque
                    codigoDisplay.textContent = data.demo_code;
                    codigoDisplay.style.display = 'block';
                    
                    // Preencher automaticamente nos campos de teste
                    document.getElementById('email2').value = email;
                    document.getElementById('codigo').value = data.demo_code;
                } else {
                    resultado.className = 'result error';
                    resultado.textContent = `‚ùå Erro:\n${JSON.stringify(data, null, 2)}`;
                    codigoDisplay.style.display = 'none';
                }
            } catch (error) {
                resultado.className = 'result error';
                resultado.textContent = `‚ùå Erro de conex√£o:\n${error.message}`;
                codigoDisplay.style.display = 'none';
            }
        }

        async function verificarCodigo() {
            const email = document.getElementById('email2').value;
            const codigo = document.getElementById('codigo').value;
            const resultado = document.getElementById('resultado2');

            if (!email || !codigo) {
                resultado.className = 'result error';
                resultado.textContent = 'Por favor, preencha email e c√≥digo';
                return;
            }

            resultado.textContent = '‚è≥ Verificando c√≥digo...';
            resultado.className = 'result';

            try {
                const response = await fetch('/verificar_codigo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email, codigo: codigo })
                });

                const data = await response.json();

                if (data.success) {
                    resultado.className = 'result success';
                    resultado.textContent = `‚úÖ ${data.message}\n\nResposta da API:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultado.className = 'result error';
                    resultado.textContent = `‚ùå ${data.message}\n\nResposta da API:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultado.className = 'result error';
                resultado.textContent = `‚ùå Erro de conex√£o:\n${error.message}`;
            }
        }

        async function testarCodigoErrado() {
            document.getElementById('codigo').value = '000000';
            await verificarCodigo();
        }

        async function testarTentativasExcedidas() {
            const resultado = document.getElementById('resultado3');
            resultado.textContent = '‚è≥ Testando 5 tentativas erradas...\n';
            resultado.className = 'result';

            const email = 'teste-tentativas@demo.com';
            
            // Primeiro gerar um c√≥digo
            await fetch('/gerar_codigo_verificacao', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email })
            });

            // Tentar 5 vezes com c√≥digo errado
            for (let i = 1; i <= 5; i++) {
                const response = await fetch('/verificar_codigo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email, codigo: '000000' })
                });
                const data = await response.json();
                resultado.textContent += `\nTentativa ${i}: ${data.message}`;
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            resultado.className = 'result error';
        }

        async function testarCodigoInexistente() {
            const resultado = document.getElementById('resultado3');
            resultado.textContent = '‚è≥ Testando c√≥digo inexistente...';
            resultado.className = 'result';

            try {
                const response = await fetch('/verificar_codigo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        email: 'nao-existe@demo.com', 
                        codigo: '999999' 
                    })
                });
                const data = await response.json();
                resultado.className = 'result error';
                resultado.textContent = `‚ùå ${data.message}\n\nResposta:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultado.className = 'result error';
                resultado.textContent = `‚ùå Erro: ${error.message}`;
            }
        }

        async function fluxoCompleto() {
            const resultado = document.getElementById('resultado4');
            const email = 'fluxo-completo@demo.com';
            
            resultado.textContent = 'üîÑ Iniciando fluxo completo...\n';
            resultado.className = 'result';

            // Passo 1: Gerar c√≥digo
            resultado.textContent += '\n1Ô∏è‚É£ Gerando c√≥digo...';
            const genResponse = await fetch('/gerar_codigo_verificacao', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email })
            });
            const genData = await genResponse.json();
            resultado.textContent += ` ‚úÖ C√≥digo: ${genData.demo_code}`;
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Passo 2: Verificar c√≥digo correto
            resultado.textContent += '\n\n2Ô∏è‚É£ Verificando c√≥digo correto...';
            const verResponse = await fetch('/verificar_codigo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: email, codigo: genData.demo_code })
            });
            const verData = await verResponse.json();
            resultado.textContent += ` ‚úÖ ${verData.message}`;

            resultado.className = 'result success';
            resultado.textContent += '\n\nüéâ Fluxo completo executado com sucesso!';
        }
    </script>
</body>
</html>
